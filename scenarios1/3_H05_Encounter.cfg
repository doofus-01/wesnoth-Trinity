#textdomain wesnoth-Trinity

[scenario]
    id="3_H05"
    name= _ "Seance"
    map_data="{~add-ons/Trinity/maps/3_H05pre.map}"
    next_scenario=3_K05
    victory_when_enemies_defeated=no
    {TURNS 25 15 10}

    [music]
        name="nunc_dimittis.ogg"
    [/music]

    #	{BMR_STORE_SIDE 1}
    #	{BMR_RESTORE_SIDE 1}
    {FIRST_WATCH}

    [story]
        [part]
            story= _ "Up in the heavens, a small and usually unnoticed part of the night sky moved into a new position.  An observer on the ground might have seen a few stars disappear, but with all the recent events, no one was paying such close attention to the constellations."
            background="story/Trinity_space0.jpg"
        [/part]
        [part]
            story= _ "As Haldrad's party headed back toward Weldyn, Dolevan's mind was racing. He had been in periodic contact with his brother Malevan for years, but he had not heard from him for over a year and a half.  In his last letter, Malevan related that he had been studying some powerful ancient culture, and had been trying to extract some of the lost knowledge and power. Dolevan wasn't sure, but he suspected the red-eyed stranger was related to his brother's work."
            background="story/landscape-plain.jpg"
        [/part]
        [part]
            story= _ "The group emerged from the foothills and were gazing across the plains towards Weldyn as a gentle breeze blew over them from the city, carrying a slightly unpleasant odor.  Something was wrong.  Dolevan shrank back into the shadows, flipping through his papers to see if his brother's letters contained anything relevant to the situation."
            background="story/landscape-bridge.jpg"
        [/part]
        [part]
            story= _ "Dardrus stopped to observe the city, and could just make out a green haze emanating from within the central district.
'I have seen this before...  What do you know of, uh, green-eyed traitors?'
'What are you talking about?,' answered Prince Haldrad.  Dolevan skimmed the letters for something about green eyes: nothing.
'The enemy is not strong, but is very devious.  They do not have bodies of their own, but they take control of vulnerable prey such as yourselves-'
'You know all of this from a foul breeze?,' interrupted the prince.
'No...  We fought against this enemy, it was a desperate battle to save the world - your people included.  We did not lose, but neither did we win.  The enemy is out there, and I've seen them responsible for such black plumes in the past.' " 
            background="story/landscape-bridge.jpg"
        [/part]
        [part]
            story= _ "Dolevan searched for some mention of battles or war in his brother's letters. He found a speculation that humans had been enslaved by beings of great strength, and that the common enemy was the 'lower half'. He didn't know what 'lower half' meant, he suspected it was a bad translation by his brother, but this information suggested that Dardrus was not to be trusted."
            background="story/landscape-bridge.jpg"
            #            background="story/Trinity_swamp.jpg"
        [/part]
        [part]
            story= _ "Prince Haldrad directed the group to head to Weldyn, in case they could provide assistance to the city defenders. They had gone a couple of miles before Haldrad realized Dolevan and his undead minions were no longer with them. He called out, but knew it was pointless for the Necromancer did not want to be with them..."
            background="story/landscape-bridge.jpg"
        [/part]
    [/story]

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Dolevan gets a Khthon kill (Thralls don't count)"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Dolevan"
            [/objective]
            [objective]
                condition=lose
                description=_ "Time Runs Out"
            [/objective]
            note=_"This is the only scenario where you play as Dolevan."
        [/objectives]
        {GENERIC_UNIT 1 "Revenant" 12 2}
        {GENERIC_UNIT 1 "Bone Shooter" 14 2}
        [unit]
            id=Khthon1
            profile=portraits/elves/ranger.png~BLIT(portraits/ker.png,0,0)~CS(-110,5,-5)
            type=Elvish Avenger
            gender=male
            side=2
            x,y=13,2
        [/unit]
        [unit]
            id=Khthon2
            type=OphisMagnum
            side=2
            x,y=14,10
        [/unit]
        [unit]
            id=Khthon3
            type=Elvish Hero
            side=2
            x,y=6,11
        [/unit]
        {ARCHAIC_KHTHONIZED id=Khthon1}
        {ARCHAIC_KHTHONIZED id=Khthon3}
        [store_unit]
            [filter]
                id=Khthon1
            [/filter]
            variable=khthon1
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id=Khthon2
            [/filter]
            variable=khthon2
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id=Khthon3
            [/filter]
            variable=khthon3
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id=Khthon_Leader
            [/filter]
            variable=khthon_leader
            kill=yes
        [/store_unit]
    [/event]

    {ARCHAIC_KHTHON_RECRUITS (
        side=2
        [not]
            race=khthon
        [/not]
    )}

    [side]
        type=Necromancer
        #	save_id=Royal
        name="Dolevan"
        id=Dolevan
        side=1
        canrecruit=yes
        controller=human
        fog=no
        recruit=Skeleton, Skeleton Archer, Walking Corpse
        {GOLD 150 125 100}
        {INCOME 6 4 2}
        team_name=Humans
    [/side]

    [side]
        type=Noble_Beast
        id=Khthon_Leader
        canrecruit=yes
        recruit=Peasant, Woodsman, Ruffian
        side=2
        controller=ai
        fog=no
        {GOLD 100 150 200}
        {INCOME 2 5 8}
        [ai]
            #            aggression=0.8
            #            grouping=offensive
            #            caution=0.9
        [/ai]
        team_name=Khthon
    [/side]

    [side]
        no_leader=yes
        side=3
        controller=ai
        fog=no
        [ai]
            aggression=0.8
            grouping=offensive
            caution=0.9
        [/ai]
        team_name=Humans
    [/side]

    [side]
        no_leader=yes
        side=4
        controller=ai
        fog=no
        [ai]
            aggression=0.8
            grouping=offensive
            caution=0.9
        [/ai]
        team_name=Phantom
    [/side]

    [event]
        name=start
        [message]
            speaker=Dolevan
            message= _ "(I don't trust that red-eyed stranger, but I don't know what to do and Malevan's letters are just confusing. I'll shadow the Prince, see if - what's that?)"
        [/message]
        [music]
            name=frantic.ogg
            append=no
            immediate=yes
        [/music]
        [move_unit_fake]
            type=Cavalryman
            x=16,10
            y=9,6
            side=3
        [/move_unit_fake]
        [unit]
            type=Cavalryman
            side=3
            id=Human1
            x,y=10,6
            facing=ne
            hitpoints=12
        [/unit]
        [message]
            speaker=Human1
            message= _ "Weldyn has fallen! Run for your life, old man!"
        [/message]
        {MODIFY_UNIT id=Human1 facing sw}
        {MOVE_UNIT id=Human1 6 8}
        [unstore_unit]
            variable=khthon3
        [/unstore_unit]
        [scroll_to]
            x,y=6,8
        [/scroll_to]
        {MOVE_UNIT id=Khthon3 5 9}
        {MODIFY_UNIT id=Khthon3 facing ne}
        [animate_unit]
            flag=attack
            [filter]
                id=Khthon3
            [/filter]
            [primary_attack]
                name=sword
            [/primary_attack]
            hits=no
        [/animate_unit]
        [delay]
            time=300
        [/delay]
        [message]
            speaker=Human1
            message= _ "Ghah!!"
        [/message]
        {MODIFY_UNIT id=Human1 facing se}
        {MOVE_UNIT id=Human1 13 10}
        [unstore_unit]
            variable=khthon2
        [/unstore_unit]
        {MODIFY_UNIT id=Khthon2 facing nw}
        [scroll_to]
            x,y=13,10
        [/scroll_to]
        [delay]
            time=500
        [/delay]
        [animate_unit]
            flag=attack
            [filter]
                id=Khthon2
            [/filter]
            [primary_attack]
                name=horns
            [/primary_attack]
            hits=yes
        [/animate_unit]
        {MODIFY_UNIT (id=Human1) side 2}
        {ARCHAIC_KHTHONIZED id=Human1}
        [sound]
            name=slowed.wav
        [/sound]
        {BMR_FLOATING_TEXT id=Human1 0,100,200 "Ethralled!"}
        [message]
            speaker=Human1
            message= _ "..."
        [/message]
        [redraw][/redraw]
        [delay]
            time=400
        [/delay]
        [message]
            speaker=Dolevan
            message= _ "(What am I seeing? What are those things?)"
        [/message]
        {MOVE_UNIT (id=Khthon3) 6 11}
        [kill]
            id=Khthon3
        [/kill]
        {MOVE_UNIT (id=Human1) 1 12}
        [kill]
            id=Human1
        [/kill]
        [kill]
            id=Khthon2
        [/kill]
        [delay]
            time=400
        [/delay]
        [unstore_unit]
            variable=khthon1
        [/unstore_unit]
        {MODIFY_UNIT id=Khthon1 facing s}
        [message]
            speaker=Khthon1
            message= _ "Hisss!"
        [/message]
        {MODIFY_UNIT id=Dolevan facing n}
        [animate_unit]
            flag=attack
            [filter]
                id=Dolevan
            [/filter]
            [primary_attack]
                name=plague staff
            [/primary_attack]
            hits=yes
        [/animate_unit]
        {MODIFY_UNIT x,y=12,2 facing ne}
        {MODIFY_UNIT id=Khthon1 facing sw}
        [animate_unit]
            flag=attack
            [filter]
                x,y=12,2
            [/filter]
            [primary_attack]
                name=axe
            [/primary_attack]
            hits=yes
        [/animate_unit]
        [message]
            speaker=Dolevan
            message= _ "Join my undead, foul one!"
        [/message]
        [animate_unit]
            flag=attack
            [filter]
                id=Dolevan
            [/filter]
            [primary_attack]
                name=plague staff
            [/primary_attack]
            hits=yes
        [/animate_unit]
        [kill]
            id=Khthon1
            animate=yes
        [/kill]
        [item]
            x,y=13,2
            image="units/elves-wood/avenger-die4.png~RC(magenta>blue)"
        [/item]
        [message]
            speaker=Dolevan
            message= _ "Hmmm...  I think it's dead..."
        [/message]
        [unit]
            side=3
            type=Duelist
            id=Lyron
            name="Advisor Lyron"
            x,y=15,7
            facing=nw
        [/unit]
        [unit]
            side=3
            type=Fencer
            x,y=16,8
            facing=nw
        [/unit]
        [unit]
            side=3
            type=Spearman
            x,y=16,7
            facing=nw
        [/unit]
        [message]
            speaker=Lyron
            message= _ "What have you there, Dolevan?"
        [/message]
        {MODIFY_UNIT (id=Dolevan) facing se}
        [message]
            speaker=Dolevan
            message= _ "Lyron...  What is going on?  Has Weldyn fallen?  To what enemy?"
        [/message]
        [message]
            speaker=Lyron
            message= _ "I was trying to smooth ruffled feathers in Carcyn, so I am not too sure how it happened, but yes, it appears Weldyn has fallen.  I am not sure what foes, but my contacts say it was elves."
        [/message]
        [message]
            speaker=Lyron
            message= _ "In any case, I wouldn't stay around here.  More like your dead friend there are wandering around."
        [/message]
        {MOVE_UNIT (id=Lyron) 16 6}
        [kill]
            side=3
        [/kill]
        {MODIFY_UNIT (id=Dolevan) facing nw}
        [delay]
            time=1000
        [/delay]
        [message]
            speaker=Dolevan
            message= _ "I must figure out what these things are, what drives them..."
        [/message]
        [delay]
            time=1000
        [/delay]
        {MODIFY_UNIT (id=Dolevan) facing se}
        [delay]
            time=1000
        [/delay]
        {MODIFY_UNIT (id=Dolevan) facing sw}
        [message]
            speaker=Dolevan
            message= _ "I'm not going to learn anything by poking at this corpse.  A seance may be necessary..."
        [/message]
        {MOVE_UNIT (id=Dolevan) 13 1}
        {FLASH_WHITE (
            [message]
                speaker=Dolevan
                message= _ "<i>Departed Spirit, tell me who you are...</i>"
            [/message]
        )}
        [delay]
            time=1000
        [/delay]
        {MODIFY_UNIT (id=Dolevan) facing se}
        [delay]
            time=1000
        [/delay]
        {MODIFY_UNIT (id=Dolevan) facing sw}
        [message]
            speaker=Dolevan
            message= _ "I think I almost had it...  I felt a presence.  Let's try that again."
        [/message]
        {FLASH_WHITE (
            [message]
                speaker=Dolevan
                message= _ "<i>Departed Spirit, do not flee.  I only wish to learn from you...</i>"
            [/message]
        )}
        [message]
            speaker=Dolevan
            message= _ "No, there are no answers there.  It's like asking questions of a walking corpse.  If I can capture one of those responsible for this plague, I should get my answers."
        [/message]
        [unstore_unit]
            variable=khthon_leader
        [/unstore_unit]
        [message]
            speaker=Khthon_Leader
            message= _ "Neyyyy!"
        [/message]
        [message]
            speaker=Dolevan
            message= _ "Is that one of them?  This is my lucky day!  I can get answers from that thing."
        [/message]
    [/event]

    # if side 2 can recruit Khthon from the start, the scenario is too trivial
    [event]
        name=turn 5
        [allow_recruit]
            side=2
            type=Horse
        [/allow_recruit]
    [/event]

    [event]
        name=die
        [filter]
            race=undead
            [not]
                type="Walking Corpse"
            [/not]
        [/filter]
        [message]
            speaker=Dolevan
            message=_"I feel I don't have the best resources at hand here...  But I can summon at least one spirit."
        [/message]
        [unit]
            side=1
            type=Ghost
            id=Ghost1
            x,y=1,1
        [/unit]
        [message]
            speaker=Ghost1
            message=_"My will is yours..."
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            id=Ghost1
        [/filter]
        [message]
            speaker=Dolevan
            message=_"Well that was unfortunate...  But I still think I can do this!"
        [/message]
    [/event]

    [event]
        name=last_breath
        [filter]
            id=Dolevan
        [/filter]
        [message]
            speaker=Dolevan
            message=_"Oh, who will figure out the secret to stopping these monsters?  Surely not that fool prince and his daemon companion..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            side=2
            [not]
                race=khthon
            [/not]
        [/filter]
        # surely there is a better filter than this.
        [filter_second]
            type=Walking Corpse, Soulless
        [/filter_second]
        [message]
            speaker=Dolevan
            message=_"Interesting, they can be re-animated..."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            race=khthon
        [/filter]
        [filter_second]
            id=Dolevan
        [/filter_second]
        [message]
            speaker=Dolevan
            message=_"Now, time to get my answers...  A battlefield seance isn't ideal, but I can move fast!"
        [/message]
        {FLASH_WHITE (
            [message]
                speaker=Dolevan
                message=_"<i>Spirit, please talk to me!  Who are you, wh-</i>"
            [/message]
        )}
        [message]
            speaker=Dolevan
            message=_"Wait, there was a second mind!  We are not alone!"
        [/message]
        [message]
            speaker=Khthon_Leader
            message=_"<i>Screeeech!</i>"
        [/message]
        {MOVE_UNIT (id=Khthon_Leader) 16 23}
        [kill]
            side=2
        [/kill]
        [message]
            speaker=narrator
            message=_"The green-eyed beasts and their thralls were clearly terrified of something.  Those that could bolted."
        [/message]
        [unit]
            type=Spirit Dove
            side=4
            x,y=2,23
            id=Dove1
        [/unit]
        {MOVE_UNIT (id=Dove1) $x2 $y2}
        [message]
            speaker=Dolevan
            message=_"That's not a bird, is it..."
        [/message]
        {MOVE_UNIT (id=Dove1) 3 20}
        {MOVE_UNIT (id=Dove1) 6 23}
        [kill]
            id=Dove1
        [/kill]
        [message]
            speaker=Dolevan
            message= _ "It wants me to follow..."
        [/message]
        {MOVE_UNIT (id=Dolevan) 6 23}
        [endlevel]
            {CONTINUE}
        [/endlevel]
    [/event]

    [event]
        name=time over
        [message]
            speaker=Dolevan
            message= _ "This is taking forever..."
        [/message]
        {FADE_TO_BLACK}
        [message]
            speaker=Dolevan
            message= _ "What is happening?"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]

[scenario]
    id="3_H05b"
    name= _ "An Encounter"
    map_data="{~add-ons/Trinity/maps/3_K03.map}"
    next_scenario=3_H05c
    victory_when_enemies_defeated=no
    {TURNS 40 35 30}

    [music]
        name="nunc_dimittis.ogg"
    [/music]

    {BMR_STORE_SIDE 1}
    {BMR_RESTORE_SIDE 1}
    {FIRST_WATCH}

    [story]
        [part]
            story= _ "The group continued on without Dolevan. Prince Haldrad hoped the Necromancer would change his mind and rejoin them, but they had to move on toward Weldyn."
            background="story/landscape-bridge.jpg"
        [/part]
        [part]
            story= _ "As they approached the outer perimeter, Prince Haldrad's party saw the guard towers were manned by... Elves?"
            background="story/landscape-bridge.jpg"
        [/part]
    [/story]

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Defeat Elvish Guards"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Haldrad"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Dardrus"
            [/objective]
            [objective]
                condition=lose
                description=_ "Time Runs Out"
            [/objective]
        [/objectives]
        [terrain]
            terrain=Gg^Ecf
            x,y=35,16
        [/terrain]
        {GENERIC_UNIT 3 "Elvish Fighter" 24 17}
        {GUARDIAN}
        {ARCHAIC_KHTHONIZED x,y=24,17}
        {GENERIC_UNIT 3 "Elvish Archer" 20 16}
        {GUARDIAN}
        {ARCHAIC_KHTHONIZED x,y=20,16}
        {GENERIC_UNIT 3 "Elvish Hero" 20 17}
        [+unit]
            experience=18
        [/unit]
        {GUARDIAN}
        {ARCHAIC_KHTHONIZED x,y=20,17}
        {GENERIC_UNIT 3 "Elvish Hero" 14 13}
        {GUARDIAN}
        {ARCHAIC_KHTHONIZED x,y=14,13}
        {GENERIC_UNIT 3 "Elvish Ranger" 12 12}
        {GUARDIAN}
        {ARCHAIC_KHTHONIZED x,y=12,12}
        [kill]
            id=Dolevan
        [/kill]
        [kill]
            race=undead
        [/kill]
        {GENERIC_UNIT 4 "Elvish Ranger" 34 15}
        {GENERIC_UNIT 4 "Elvish Ranger" 34 16}
        {GENERIC_UNIT 4 "Elvish Avenger" 35 15}
        [+unit]
            id=Avenger1
            gender=male # to make sure the portrait doesn't get screwed up later
            {IS_HERO}
        [/unit]
        {GENERIC_UNIT 4 "Elvish Archer" 36 15}
        [recall]
            id=Dardrus
        [/recall]
        [set_variable]
            name=fog_here
            value=0
        [/set_variable]
        {ARCHAIC_KHTHONIZE_MAJOR (id=Khthon1)}
    [/event]

    [side]
        type=Haldrad Fighter
        save_id=Royal
        id=Haldrad
        side=1
        canrecruit=yes
        controller=human
        fog=no
        recruit=Peasant,Woodsman,Spearman,Bowman
        {GOLD 150 125 100}
        {INCOME 6 4 2}
        team_name=Royal
    [/side]

    [side]
        side=2
        controller=ai
        fog=no
        canrecruit=yes
        type=Flying Toad
        id=Toad1
        recruit=Toad
        {GOLD 100 120 160}
        {INCOME 2 4 6}
        [ai]
            aggression=0.8
            grouping=offensive
            caution=0.9
        [/ai]
        team_name=Khthon
    [/side]

    {STARTING_VILLAGES_AREA 2 26 30 8}

    [side]
        side=3
        controller=ai
        fog=no
        canrecruit=yes
        type=Elvish Captain
        facing=se
        id=Khthon1
        profile=portraits/elves/captain.png~BLIT(portraits/kec2.png,0,0)~CS(-100,5,-5)
        name=Echabarrom
        recruit=Elvish Fighter, Elvish Archer, Elvish Scout, Elvish Shaman
        {GOLD 120 150 190}
        {INCOME 2 4 6}
        [ai]
            aggression=0.8
            grouping=offensive
            caution=0.9
            [aspect]
                id=attacks
                [facet]
                    invalidate_on_gamestate_change=yes
                    [filter_own]
                        side=3 # don't remember what an empty filter does
                    [/filter_own]
                    [filter_enemy]
                        side=1
                    [/filter_enemy]
                [/facet]
            [/aspect]
        [/ai]
        team_name=Khthon
    [/side]

    {STARTING_VILLAGES_AREA 3 10 6 10}
    {ARCHAIC_KHTHON_RECRUITS (side=3)}

    [side]
        no_leader=yes
        side=4
        controller=ai
        fog=no
        [ai]
            aggression=-1.0
            grouping=defensive
            caution=0.9
            [goal]
                name=protect_unit
                [criteria]
                    id=Avenger1
                [/criteria]
                protect_radius=4
                value=8
            [/goal]
            [aspect]
                id=attacks
                [facet]
                    id=cover_up
                    invalidate_on_gamestate_change=yes
                    [filter_own]
                        side=4
                    [/filter_own]
                    [filter_enemy]
                        [and]
                            type=Toad
                            [filter_location]
                                terrain=Gg
                            [/filter_location]
                        [/and]
                    [/filter_enemy]
                [/facet]
            [/aspect]
        [/ai]
        team_name=Royal
    [/side]

    [event]
        name=start
        {MODIFY_UNIT (id=Haldrad) facing sw}
        [message]
            speaker=Haldrad
            message= _ "Elves manning the guard towers? Is the battle going so badly that the Royal Guard must be outsourced to Elves?"
        [/message]
        [scroll_to]
            x,y=2,4
        [/scroll_to]
        [delay]
            time=500
        [/delay]
        [message]
            speaker=Dardrus
            message= _ "Prince, there is something very wrong with them... Remember when I asked about green-eyed traitors?  These are the ones I was referring to!"
        [/message]
        [message]
            speaker=Haldrad
            message= _ "(Ah, I see.  You don't like Elves...)  Elf Captain!  Why do our woodland friends play the role of guardians?  What has happened to the Royal Guard?"
        [/message]
        [message]
            id=Khthon1
            message= _ "Nothing is wrong.  Welcome, <i>human</i>..."
        [/message]
        [message]
            speaker=Dardrus
            message= _ "Those were once Elves, but they are no longer Elves. They are the Enemy, set aside any hesitation for you are in great danger."
        [/message]
        [message]
            speaker=Haldrad
            message= _ "His response was quite odd, I'm inclined to believe you.  But now we must ask if Weldyn has been lost?  Or are we needed there to break a siege?"
        [/message]
        [message]
            speaker=Avenger1
            message= _ "We hope it is a siege!  I offer my respect and loyalty, Prince Haldrad, let me explain why we are here:

Lord Ullien-Del went to Weldyn, and we know there was a fierce battle, with strange vapors descending upon the city.  Since then, our bretheren have been enslaved to something like the Lichs of old - we are in the grip of a terrible plague...  Our Lord and your leadership are quite strong, and must be holed up in the castle."
        [/message]
        [message]
            speaker=Haldrad
            message= _ "Well, let us hope!  Very well, my woodland friend, let us come to their aid!"
        [/message]
        [set_variable]
            name=weldyn_here
            value=0
        [/set_variable]
        [music]
            name=battle.ogg
            append=no
            immediate=yes
        [/music]
        [terrain]
            terrain=Ce
            x,y=42-45,15
        [/terrain]
        [terrain]
            terrain=Ke
            x,y=44,14
        [/terrain]
        #testing
        #	    {ARCHAIC_KHTHONIZE_MAJOR (side=4)}
    [/event]

    [event]
        name=enter_hex
        [filter]
            side=1
            x=20
        [/filter]
        [allow_undo]
        [/allow_undo]
        [set_variable]
            name=crossed
            value=yes
        [/set_variable]
    [/event]

    [event]
        name=new turn
        [filter_condition]
            [variable]
                name=crossed
                equals=yes
            [/variable]
        [/filter_condition]
        [unit]
            type=Dragoon
            side=1
            id=Dragoon1
            x,y=45,15
            facing=sw
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [message]
            speaker=Dragoon1
            message=_"Prince Haldrad, praise the fates you are alive!  You know Weldyn has been lost, do you not?  I doubt your forces are enough to dislodge the enemy."
        [/message]
        {MODIFY_UNIT (id=Haldrad) facing ne}
        [message]
            speaker=Haldrad
            message=_"That is grim news.  May I ask what you have been doing, while Weldyn was being overrun?"
        [/message]
        [message]
            speaker=Dragoon1
            message=_"Well, I've been guarding the retreating forces.  Prince, we need to get you out of here!  Queen Caldera would kill me if anything should happen to you!"
        [/message]
        [message]
            speaker=Haldrad
            message=_"Would she?  She's still alive?"
        [/message]
        [message]
            speaker=Dragoon1
            message=_"Yes!  The enemy knew when to strike!  Only Ryaeron, Saleanna, and Daenyr were in Weldyn to defend the city when we were attacked.  You were off to fetch Advisor Dolevan, the Queen was off to Elensefar, and Advisor Lyron had been dispatched to Carcyn.  We were at our weakest!"
        [/message]
        [message]
            speaker=Haldrad
            message=_"This is good news - well, relatively good news.  Weldyn has fallen, but our Kingdom's forces have not yet been defeated.  We shall go to Elensefar!  Do you hear that, loyal Elves?"
        [/message]
        [message]
            speaker=Avenger1
            message=_"Yes, we hear!  On to Elensefar!"
        [/message]
        [music]
            name=siege_of_laurelmor.ogg
            immediate=yes
            append=no
        [/music]
        [message]
            speaker=Dragoon1
            message=_"Prince...  There are no loyal elves left, these ones deceive you!  We have fallen prey to this ruse once before, don't you do the same!"
        [/message]
        {GENERIC_UNIT 4 "Elvish Ranger" 17 33}
        {GENERIC_UNIT 4 "Elvish Ranger" 36 4}
        {GENERIC_UNIT 4 "Elvish Ranger" 29 24}
        {ARCHAIC_KHTHONIZED side=4 }
        {ARCHAIC_KHTHONIZE_MAJOR (id=Avenger1)}
        [modify_unit]
            [filter]
                id=Avenger1
            [/filter]
            {ARCHAIC_TRAIT_ENTHRALL}
        [/modify_unit]
        [modify_side]
            side=4
            team_name=Khthon
        [/modify_side]
        {MODIFY_AI_DELETE_ASPECT 4 attacks cover_up}
        [store_unit]
            [filter]
                id=Avenger1
            [/filter]
            variable=avenger_TEMP
            kill=no
        [/store_unit]
        [set_variable]
            name=avenger_TEMP.profile
            value=portraits/elves/ranger.png~BLIT(portraits/ker.png,0,0)~CS(-110,5,-5)
        [/set_variable]
        [set_variable]
            name=avenger_TEMP.name
            value="Aramemon"
        [/set_variable]
        [unstore_unit]
            variable=avenger_TEMP
            find_vacant=no
        [/unstore_unit]
        {CLEAR_VARIABLE avenger_TEMP}
        [message]
            speaker=Avenger1
            message=_"You can't blame us for trying..."
        [/message]
        [message]
            speaker=Haldrad
            message=_"I certaily can, sly one.  We will not run away with our tails between our legs.  Men, let's show these lying daemon elves Weldyn courage!"
        [/message]
    [/event]

    # They are sandbagging, after all.  But modifying AI behaviour would be better, try that first
    # I'm not sure which is less obvious...
    #    {FORCE_CHANCE_TO_HIT (side=4) (side=2,3) 10 ()}
    #    {FORCE_CHANCE_TO_HIT (side=2,3) (side=4) 10 ()}

    # player wins if side 3 is culled to 0-4 units, but only after having killed Avenger1 as well
    # changing this to 0-6 units, so it is basically just a death after the Avenger is defeated.
    [event]
        name=die
        [filter]
            side=3
        [/filter]
        [filter_condition]
            [variable]
                name=av1_dead
                equals=yes
            [/variable]
            [have_unit]
                side=3
                count=0-4
            [/have_unit]
        [/filter_condition]
        [message]
            speaker=Haldrad
            message= _ "We have damaged the enemy about as well as we could hope for now, but they will catch up if we don't get moving!  Let's go!"
        [/message]
        [endlevel]
            {CONTINUE}
        [/endlevel]
    [/event]

    [event]
        name=last_breath
        [filter]
            id=Avenger1
        [/filter]
        [message]
            speaker=Haldrad
            message= _ "What do you have to say for yourself, traitor?"
        [/message]
        [message]
            speaker=Avenger1
            message= _ "Traitor?  Hahaha!  How little you understand us..."
        [/message]
        [set_variable]
            name=av1_dead
            value=yes
        [/set_variable]
        [animate_unit]
            flag=attack
            [filter]
                id=Avenger1
            [/filter]
            [primary_attack]
                name=khthon_vector
            [/primary_attack]
            hits=no
        [/animate_unit]
        [kill]
            id=Avenger1
            animate=yes
        [/kill]
        [message]
            speaker=Haldrad
            message= _ "What the hell was that?"
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            id=Dardrus
        [/filter]
        [message]
            speaker=Haldrad
            message= _ "Oh, this is not good..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            id=Haldrad
        [/filter]
        [message]
            speaker=Dardrus
            message= _ "Well, so much for that..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=time over
        [message]
            speaker=Haldrad
            message= _ "We are being over-run. I see movement on all sides, there is no escape."
        [/message]
        {FADE_TO_BLACK}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]

[scenario]
    id="3_H05c"
    #    id="3_H05b"
    name= _ "Seth"
    map_data="{~add-ons/Trinity/maps/damned_tower/outside.map}"
    next_scenario=3_P05
    #    next_scenario=3_H05c
    victory_when_enemies_defeated=no
    {TURNS 25 15 10}

    [music]
        name="nunc_dimittis.ogg"
    [/music]

    #	{BMR_STORE_SIDE 1}
    #	{BMR_RESTORE_SIDE 1}
    {FIRST_WATCH}

    [story]
        [part]
            story= _ "Dolevan followed the ghostly dove toward the ruins of Weldyn.  As he did so, he noticed the darkening of the sky and the seeming rot of the earth."
            background="story/Trinity_maelstrom.jpg"
        [/part]
        [part]
            story= _ "The rot seemed to get worse and worse as he continued.  One might think a Necromancer would feel at home, but what the Necromancers pursue is a form of stasis, and there was nothing hinting at stasis in what Dolevan saw.  There was only decay, ruin, and (most disturbingly) a sense of finality.  It was like death, but on a higher level.  Dolevan choked down his unease, and continued to follow the dove."
            background="story/Trinity_maelstrom.jpg"
        [/part]
        [part]
            story= _ "Eventually, they reached the vicinity of the capital, and where the Royal Palace once stood was a tall, ominous tower.  Dolevan felt he was going to learn about the monsters destroying his world, but feared his part in this story would not extend much beyond that."
            background="story/Trinity_tower.jpg"
        [/part]
    [/story]

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                condition=lose
                description=_ "Time Runs Out"
            [/objective]
            note=_"This is the only scenario where you play as Dolevan."
        [/objectives]
        [unit]
            type=Spirit Dove
            side=2
            id=Dove1
            x,y=15,89
        [/unit]
        {TELEPORT_UNIT (id=Dolevan) 15 90}
        [item]
            x,y=15,74
            image=misc/skull-banner.png
        [/item]
        [item]
            image=misc/sand-skull-1.png
            x,y=12,79
        [/item]
        [item]
            image=misc/sand-skull-1.png
            x,y=18,79
        [/item]
    [/event]

    [side]
        type=Necromancer
        #	save_id=Royal
        name="Dolevan"
        id=Dolevan
        side=1
        canrecruit=yes
        controller=human
        fog=no
        recruit=Skeleton, Skeleton Archer, Walking Corpse
        {GOLD 150 125 100}
        {INCOME 6 4 2}
        team_name=Undead
    [/side]

    [side]
        type=Seth
        id=Seth
        name="Seth"
        canrecruit=yes
        recruit=Tomb Guard
        side=2
        controller=ai
        fog=no
        {GOLD 100 150 200}
        {INCOME 2 5 8}
        [ai]
            aggression=0.8
            grouping=offensive
            caution=0.9
        [/ai]
        team_name=Phantom
        [unit]
            type=Tomb Shield
            id=Shield1
            x,y=18,81
            facing=sw
        [/unit]
        [unit]
            type=Tomb Shield
            id=Shield2
            x,y=13,81
            facing=se
        [/unit]
        [unit]
            type=Tomb Protector
            id=Protector1
            x,y=16,77
            facing=sw
        [/unit]
    [/side]

    [event]
        name=start
        [message]
            speaker=Dolevan
            message= _ "Well, Dove?  Here we are..."
        [/message]
        {MOVE_UNIT (id=Dove1) 15 84}
        [message]
            speaker=Dolevan
            message= _ "Those must be your masters up ahead, Dove..."
        [/message]
        {MOVE_UNIT (id=Dolevan) 15 85}
        {MOVE_UNIT (id=Dove1) 14 77}
        [message]
            speaker=Seth
            message= _ "Welcome, wise one.  We've met before, but it was oh-so brief...  Too brief.  I am Seth."
        [/message]
        {MOVE_UNIT (id=Dolevan) 15 81}
        [scroll_to]
            x,y=15,76
        [/scroll_to]
        [message]
            speaker=Dolevan
            message= _ "And I am Dolevan...  You say we have met?"
        [/message]
        [message]
            speaker=Seth
            message= _ "Yes, briefly, when you tried to talk to the spirit of that beast you slayed.  It was too brief for me to gather much, but I could recognize a fellow soul.  Tell me, do you like what I've created here?"
        [/message]
        [message]
            speaker=Dolevan
            message= _ "It is... impressive... in it's own way, I suppose.  How are we fellow souls?"
        [/message]
        [message]
            speaker=Seth
            message= _ "You do not wish to perish and become something else, you go to great lengths to ensure that death does not change you to something too far from your current form."
        [/message]
        [message]
            speaker=Seth
            message= _ "I am the same, I do not wish to change.  In a former life, I was a high-ranking scribe and priest for this world's most powerful empire.  Then a god came down, and a great battle ensued.  The god was defeated, and changed.  I was part of that change - I changed, I became part of that god."
        [/message]
        [message]
            speaker=Dolevan
            message= _ "That change was a form of death?"
        [/message]
        [message]
            speaker=Seth
            message= _ "Yes, it was terrible.  I cannot allow it to happen again, I will not allow us to fall farther from our former godly existance - I will restore our godly existance."
        [/message]
        [message]
            speaker=Dolevan
            message= _ "'Our'?"
        [/message]
        [message]
            speaker=Seth
            message= _ "The green-eyed beasts are fragments of my god, but they embrace the change, and make it harder to restore our god.  And they are not the only ones; so much of this world has little fragments of my god scattered throughout.  Which is why I brought you here."
        [/message]
        [message]
            speaker=Seth
            message= _ "I must unravel the knots of change made by Khthon interaction in this world, I must reclaim all of the pieces scattered throughout the land.  This tower shall be my means to that end."
        [/message]
        [message]
            speaker=Dolevan
            message= _ "This tower?  How?  What does it have to do with me?"
        [/message]
        [message]
            speaker=Seth
            message= _ "There is no easy way to gather the fragments, it will require conventional forces and this tower is my foothold.  The Khthon, as well as the native denizens of this world, will also be drawn to this tower like moths to a flame...

They will fear and hate us, a reception with which I know you are familiar.  Will you join me in defeating the forces of this world, and bringing the green-eyed beings back to the fold?  Will you help me restore my god?"
        [/message]
        [message]
            speaker=Dolevan
            message= _ "No!  I've seen enough to know that I want no part of this!  I'm leaving!"
        [/message]
        {MOVE_UNIT (id=Dolevan) 15 82}
        [message]
            speaker=Seth
            message= _ "I think you know that is not an option..."
        [/message]
        [music]
            name=One_Thousand_Suns.ogg
            append=no
            immediate=yes
        [/music]
        {MOVE_UNIT id=Seth 15 81}
        [animate_unit]
            flag=attack
            [filter]
                id=Seth
            [/filter]
            [primary_attack]
                range=ranged
            [/primary_attack]
            [facing]
                x,y=15,82
            [/facing]
            hits=yes
        [/animate_unit]
        [item]
            halo=halo/holy/light-beam-4.png
            x,y=15,82
        [/item]
        [message]
            speaker=Dolevan
            message= _ "<i>(Gasp!)</i>  You knew I'd think you an abomination, you know we are not the same...  <i>(groan)</i>  Why did you bring me here?"
        [/message]
        [message]
            speaker=Seth
            message= _ "I need to retrieve my foolish Echidna, and these phantoms of my former life are not enough.  You were the most tolerable of those already on the ground..."
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "Dolevan felt a blinding pain, then the world became dream-like.  He felt a wave of despair and defeat, and knew Seth was now his lord and master."
        [/message]
        [remove_item]
            halo=halo/holy/light-beam-4.png
            x,y=15,82
        [/remove_item]
        [message]
            speaker=Seth
            message= _ "It should give you some small pleasure to know that my presence here has caused me to change again.  But I must take this step into depravity to pull us clear!"
        [/message]
        {MOVE_UNIT (id=Seth) 15 78}
        [kill]
            id=Dolevan
            animate=no
        [/kill]
        [endlevel]
            {CONTINUE}
            replay_save=no
        [/endlevel]
    [/event]
[/scenario]
